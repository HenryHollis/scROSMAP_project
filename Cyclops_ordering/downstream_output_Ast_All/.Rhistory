gene_lists = list.files("./enrichR_files/", pattern = "^(CTL_|AD_|DR_)")
gene_lists
setwd("enrichR_files/")
DR_gene_lists = list.files( pattern = "^(DR_)")
DR_gene_lists
setwd("enrichR_files/")
#Diff_rhythms
setwd(paste0(path_to_cyclops_ordering, "diff_rhythms"))
path_no_space
paste0("python3 ", path_no_space, "/Python_EnrichR_for_AnalysisPipeline.py -g \"enrichR_files/strong_cogdx_diffs_AR25.csv \" -b \"",y , "\"")
paste0("python3 ", path_no_space, "/Python_EnrichR_for_AnalysisPipeline.py -g \"enrichR_files/strong_cogdx_diffs_AR25.csv \" -b \"AD_cyclers_AR25Bonf05.csv\"")
#AD severity
system(paste0("python3 ", path_no_space, "/Python_EnrichR_for_AnalysisPipeline.py -g \"enrichR_files/strong_cogdx_diffs_AR25.csv \" -b \"AD_cyclers_AR25Bonf05.csv\""))
#AD severity
system(paste0("python3 ", path_no_space, "/Python_EnrichR_for_AnalysisPipeline.py -g \"enrichR_files/strong_cogdx_diffs_AR25.csv \" -b \"enrichR_files/AD_cyclers_AR25Bonf05.csv\""))
Ensembl = Ensembl_dict$ENSEMBL[match(strong_cogdx_diffs$Gene_Symbols, Ensembl_dict$Gene_Symbol)]
strong_cogdx_diffs = cbind(Ensembl, strong_cogdx_diffs) %>% select(Ensembl , Gene_Symbols )
strong_cogdx_diffs
write.table(strong_cogdx_diffs, paste(order_path, "diff_rhythms", "enrichR_files", "strong_cogdx_diffs_AR25.csv", sep = "/"), sep = ',', row.names = F, col.names = T)
strong_cogdx_diffs
rownames(strong_cogdx_diffs)
write.table(strong_cogdx_diffs, paste(order_path, "diff_rhythms", "enrichR_files", "strong_cogdx_diffs_AR25.csv", sep = "/"), sep = ',', row.names = F, col.names = T)
#AD severity
system(paste0("python3 ", path_no_space, "/Python_EnrichR_for_AnalysisPipeline.py -g \"enrichR_files/strong_cogdx_diffs_AR25.csv \" -b \"enrichR_files/AD_cyclers_AR25Bonf05.csv\""))
paste0("python3 ", path_no_space, "/Python_EnrichR_for_AnalysisPipeline.py -g \"enrichR_files/strong_cogdx_diffs_AR25.csv \" -b \"enrichR_files/AD_cyclers_AR25Bonf05.csv\"")
paste0("python3 ", path_no_space, "/Python_EnrichR_for_AnalysisPipeline.py -g \"enrichR_files/strong_cogdx_diffs_AR25.csv \" -b \"enrichR_files/AD_cyclers_AR25Bonf05.csv\"")
#AD severity
system(paste0("python3 ", path_no_space, "/Python_EnrichR_for_AnalysisPipeline.py -g \"enrichR_files/strong_cogdx_diffs_AR25.csv\" -b \"enrichR_files/AD_cyclers_AR25Bonf05.csv\""))
BiocManager::install("mygene")
library(mygene)
?mygene
browseVignettes("mygene")
getGene("ARNTL")
> getGenes(c("ENSG00000148795"))
> getGenes(("ENSG00000148795"))
getGenes(("ENSG00000148795"))
getGenes(("ENSG00000148795"), fields = a;;)
getGenes(("ENSG00000148795"), fields = "All")
getGenes(("ENSG00000148795"), fields = "all")
setwd("~/Box Sync/Henry_stuff/AD_project/scROSMAP/counts/")
list.files()
read_csv("Excitatory_Neurons_counts.csv")
setwd("~/Box Sync/Henry_stuff/AD_project/PseudoBulkVillas/Jan12/")
load("rosmap424_pseudobulk_by_cluster.rda")
counts
rownames(conts)
rownames(counts)
gene_symbols = rownames(counts)
gene_symbols
setwd("~/Box Sync/Henry_stuff/AD_project/scROSMAP/Rscripts/")
setwd("~/Box Sync/Henry_stuff/AD_project/scROSMAP/Rscripts/automatic_downstream_analysis/")
df = read_excel("scROSMAP_ENSEMBL_dict.xlsx")
df
View(df)
is.na(df)
which(is.na(df))
getGenes(df$ENSEMBL)
test = getGenes(df$ENSEMBL[1], fields = "all")
View(test)
test = getGenes(df$ENSEMBL[1])
df$ENSEMBL[1]
test = getGenes(c(df$ENSEMBL[1]), fields = "all")
test = getGenes(df$ENSEMBL[1:2], fields = "all")
test = getGenes('ENSG00000133794', fields = "all")
test@listData[["ensembl.protein"]][[1]]
test = getGenes('ENSG00000133794', fields = "alias")
test = getGenes('ENSG00000133794', fields = "alias")
test@listData[["alias"]][[1]]
df_w_alias = getGenes(df$ENSEMBL, fields = "alias")
View(df_w_alias)
df_w_alias@listData[["alias"]]
as.data.frame(df_w_alias@listData[["alias"]])
df_w_alias@listData[["alias"]][[2]]
class(df_w_alias@listData[["alias"]][[2]])
r <- list(structure(c(21, 1), .Names = c("AA", "AB")), structure(c(19,
4), .Names = c("AA", "AB")), structure(c(23, 1), .Names = c("AA",
"AB")), structure(c(15, 3, 6), .Names = c("AA", "AB", "BB")))
r
r[[4]]
class(r[[4]])
r1 <- lapply(r, as.data.frame.list)
r1
class(r``)
class(r1)
library(data.table)
rbindlist(r, fill=TRUE)
library(data.table)
rbindlist(r1, fill=TRUE)
r1 <- lapply(df_w_alias, as.data.frame.list)
tmp = df_w_alias@listData[["alias"]]
r1 <- lapply(tmp, as.data.frame.list)
r1
rbindlist(r1, fill = T)
tmp = df_w_alias@listData[["alias"]]
tmp <- lapply(tmp, as.data.frame.list)
tmp
tmp2 = tmp
df_w_alias = rbindlist(tmp2)
df_w_alias = rbindlist(tmp2, fill = T)
View(df_w_alias)
tmp2
df_w_alias = getGenes(df$ENSEMBL, fields = "alias")
res <- as.data.frame(t(stri_list2matrix(df_w_alias@listData[["alias"]])))
library(stringi)
res <- as.data.frame(t(stri_list2matrix(df_w_alias@listData[["alias"]])))
res
View(res)
unique(unlist(sapply(df_w_alias@listData[["alias"]], names)))
df_w_alias = getGenes(df$ENSEMBL, fields = "alias")
library(stringi)
res <- as.data.frame(t(stri_list2matrix(df_w_alias@listData[["alias"]])))
View(df)
cbind(df, res)
out = cbind(df, res)
View(out)
xlsx::write.xlsx(out, "scROSMAP_genes_w_alias.xlsx", col.names =T, row.names = F, showNA = F)
install.packages("xlsx")
xlsx::write.xlsx(out, "scROSMAP_genes_w_alias.xlsx", col.names =T, row.names = F, showNA = F)
openxlsx
install.packages("openxlsx")
openxlsx::write.xlsx(out, "scROSMAP_genes_w_alias.xlsx", colNames =T, rowNames() = F, keepNA = F)
openxlsx::write.xlsx(out, "scROSMAP_genes_w_alias.xlsx", colNames =T, rowNames= F, keepNA = F)
library(Seurat)
library(edgeR)
library(NMOF)
library(parallel)
library(tidyverse)
library(deltaccd)
library(gridExtra)
library(grid)
load("../rosmap424_pseudobulk_by_cluster.rda")
#clean up column (subcluster names)
colnames(counts) = str_replace(colnames(counts), "_donor", "")
colnames(counts) = str_replace(colnames(counts), ".rds", "")
rownames(pseudobulk_meta) = colnames(counts)
#read in subject metadata
rosmap_subject_metadata = read.csv("../ROSMAP_metadata/cleaned_rosmap_meta_cogdxConds.csv")
#read in another file with sequencing info for all scRNAseq done for ROSMAP
rosmap_scassay_meta = read_csv("../ROSMAP_metadata/ROSMAP_assay_scrnaSeq_metadata.csv", show_col_types = F)
#Seurat now complains when groub.by argument in AggregrateCounts is numeric so I'll change them in rosmap_metadata and pseudobulk_meta:
pseudobulk_meta$project_id = paste0("X", pseudobulk_meta$project_id)
rosmap_subject_metadata$projid = paste0("X", rosmap_subject_metadata$projid)
#remove the cogdx 6 subjects from the metadata file
rosmap_meta = filter(rosmap_subject_metadata, cogdx != 6)
#merge large meta_data file with sequencing info
rosmap_scassay_meta = rosmap_scassay_meta %>% separate_wider_delim(cols = 2, delim = "_", names = c("col1", "individualID"), too_many = "drop", too_few = "align_start")
# full_meta = merge(rosmap_meta, rosmap_scassay_meta, by = "individualID", all.x = T)
rosmap_meta$batch = rosmap_scassay_meta$rnaBatch[match(rosmap_meta$individualID, rosmap_scassay_meta$individualID)]
rosmap_meta$batch = str_extract(rosmap_meta$batch, "(?<=-B)[0-9]*") %>% as.numeric
rosmap_meta = rosmap_meta %>%
mutate(batch_bin = cut(batch, c(4, 10, 64), right = F))
##### AUGMENT ROSMAP_META #####
rosmap_meta = rosmap_meta %>%
mutate(braaksc_bin = cut(braaksc, c(0, 3, 5, 7), right = F))
rosmap_meta = rosmap_meta %>%
mutate(ceradsc_bin = cut(ceradsc, c(1, 3, 5), right = F))
rosmap_meta$apoe_ordinal  = 1
rosmap_meta$apoe_ordinal[rosmap_meta$apoe_genotype == 34 | rosmap_meta$apoe_genotype == 24] = 2
rosmap_meta$apoe_ordinal[rosmap_meta$apoe_genotype == 44 ] = 3
rosmap_meta$apoe_ordinal[is.na(rosmap_meta$apoe_genotype) ] = NA
rosmap_meta$age_death_numeric = rosmap_meta$age_death %>% str_replace("\\+", "") %>% as.numeric
#adds cogdx score for each subcluster
pseudobulk_meta$cogdx = rosmap_meta$cogdx[match(pseudobulk_meta$project_id, rosmap_meta$projid)]
pseudobulk_meta$cond_cogdx = rosmap_meta$cond_cogdx[match(pseudobulk_meta$project_id, rosmap_meta$projid)]
pseudobulk_meta$pmi = rosmap_meta$pmi[match(pseudobulk_meta$project_id, rosmap_meta$projid)]
pseudobulk_meta$sex = rosmap_meta$msex[match(pseudobulk_meta$project_id, rosmap_meta$projid)]
sex_table = table(rosmap_meta$cond_cogdx, rosmap_meta$msex)
colnames(sex_table) = c("female", "male")
rownames(sex_table)= c("cond_0", "cond_1")
#creates a seurat object
seurat_obj = CreateSeuratObject(
counts,
project = "scRNA ROSMAP",
assay = "RNA",
names.field = 3,
names.delim = "_",
meta.data = pseudobulk_meta)
#get Ribo Protein percent
seurat_obj <- PercentageFeatureSet(seurat_obj, "^RP[SL]", col.name = "percent_ribo")
# Percentage hemoglobin genes - includes all genes starting with HB except HBP.
seurat_obj <- PercentageFeatureSet(seurat_obj, "^HB[^(P)]", col.name = "percent_hb")
#Does number of ribosoal features (%ribo * n_features) change with cogdx
RPSL.genes <- grep(pattern = "^RP[SL]", x = rownames(x = seurat_obj@assays$RNA$counts), value = TRUE)
counts.RPS <- Matrix::colSums(seurat_obj@assays$RNA$counts[RPSL.genes, ])
seurat_obj = AddMetaData(
object = seurat_obj,
metadata = counts.RPS,
col.name = "cnts_ribo"
)
# VlnPlot(seurat_obj, group.by = "cond_cogdx", features = c("cnts_ribo", "pmi"), pt.size = 0.1, ncol = 1, alpha = 0)
#plot QC mertrics
# feats <- c("nFeature_RNA", "nCount_RNA", "percent_ribo")
# VlnPlot(seurat_obj, group.by = "broadclass", features = feats, pt.size = 0.1, ncol = 2, alpha = 0.05) +
# NoLegend()
#creates a reference correlation matrix
refCor = getRefCor(species = "human", tissue = "pan", useEntrezGeneId = F)
loss = function(str){
expr = FetchData(seurat_obj, vars = "cluster")
tmp = seurat_obj[,grep(str, expr$cluster)]
cts <- AggregateExpression(tmp,
group.by = c("project_id"),
assays = 'RNA',
slot = "counts",
return.seurat = FALSE)
cts = cts$RNA[,na.exclude(match(rosmap_meta$projid, colnames(cts$RNA)))]
my_rosmap_meta = rosmap_meta[match(colnames(cts), rosmap_meta$projid), ]
#create DGElist
y <- DGEList(counts = cts, group = my_rosmap_meta$cond_cogdx)
#default params for filterByExpression
keep.genes = filterByExpr(y)
if (all(keep.genes[rownames(refCor)])){
#filter out the genes
y = y[keep.genes, , keep=FALSE]
# print(paste("keeping", dim(y)[1], "genes"))
my_tmm_DGE_obj <- calcNormFactors(y, method = "TMM")
my_tmm = cpm(my_tmm_DGE_obj) #calculate tmms: https://www.biostars.org/p/317701/
my_tmm = as.data.frame(my_tmm)
# all(colnames(my_tmm) == (rosmap_meta$projid))
try({
ans = calcCCD(refCor, emat = as.data.frame(my_tmm[rownames(refCor),]), groupVec = my_rosmap_meta$cond_cogdx)
return(ans$CCD[1])},
silent = T
)
return(Inf)
}
return(Inf)
}
n = 16 #number of subclusters to consider
l <- rep(list(0:1), n)
df=expand.grid(l)
colnames(df) = paste0("Exc\\.", 1:n,"$") #replace `Ast` for other subclusters, ie. Exc, Inh, Mic, etc.
strs = c()
for (i in 2:nrow(df)){
out = paste(colnames(df)[which(df[i,] == 1)], collapse = "|")
strs = c(strs, out)
}
2^16-1
tic = Sys.time()
grid_results = gridSearch(loss, levels = list(str = strs), method = 'multicore', mc.control = list(mc.cores = 10))
load("/Users/henryhollis/Box Sync/Henry_stuff/AD_project/scROSMAP/BestSubclusters_server.rda")
View(grid_results)
sort(values)
sort(grid_results$values)
order(grid_results$values)
idx = order(grid_results$values)
grid_results$minlevels[idx]
grid_results$levels[idx]
sorted_levels = grid_results$levels[idx]
View(sorted_levels)
hist(grid_results$values)
grep("Exc\\.3", sorted_levels)
grep("Exc\\.3$", sorted_levels)
grep("Exc\\.3", sorted_levels[["values"]])
sort_values[[3]]
sorted_values[[3]]
sorted_leveles[["values"]]
sorted_levels[["values"]]
sorted_levels[,2]
sorted_levels
sorted_levels %>% list()
sorted_levels %>% unlist
sorted_levels= sorted_levels %>% unlist
grep("Exc\\.3", sorted_levels)
sorted_levels
class(sorted_levels)
grep("Exc\\.3$", sorted_levels)
grep("Exc", sorted_levels)
grep("Exc\\\\.3", sorted_levels)
View(grid_results)
sorted_levels
grep("Exc\\\\.3", sorted_levels)[1:100]
sort(grid_results$values)
grep("Exc\\\\.3", sorted_levels)[1:500]
grep("Exc\\\\.3|Exc\\\\.5", sorted_levels)[1:500]
grep("Exc\\\\.3|Exc\\\\.5", sorted_levels)[1:500] %>% length()
grep("Exc\\\\.3|Exc\\\\.5", sorted_levels[1:500])
str_extract_all(sorted_levels[1:500], "\d+")
str_extract_all(sorted_levels[1:500], "\\d+")
numbers = str_extract_all(sorted_levels[1:500], "\\d+")
View(numbers)
sorted_levels
numbers = str_extract_all(sorted_levels[1:500], "\\d+") %>% rbind
View(numbers)
numbers = str_extract_all(sorted_levels[1:500], "\\d+")
numbers = str_extract_all(sorted_levels[1:500], "\\d+")
View(numbers)
test = list_rbind(numbers)
list_flatten(numbers)
numbers = str_extract_all(sorted_levels[1:500], "\\d+") %>% unlist(use.names = F)
table(numbers)
library(reticulate) #use to find conda env for python
library(tidyverse)
source("./downstream_helpers/differential_rhyth_generalized.R")
source("./downstream_helpers/create_rnk_files.R")
source("./downstream_helpers/fgsea.R")
source("./downstream_helpers/Files_for_Pscan.R")
source("./downstream_helpers/Make_KEGG_map_files.R")
source("./downstream_helpers/Check_TF_for_cycling_or_DR.R")
source("./downstream_helpers/plot_clock_face_plots.R")
source("./downstream_helpers/plot_gene_traces_generalized.R")
source("./downstream_helpers/order_metabolon.R")
source("./downstream_helpers/order_proteomics.R")
conda_list()
#path to cyclops ordering
path_to_cyclops_ordering = "../Cyclops_ordering/"
#path to normalized counts
path_to_tmm_file = "../normed_counts/ALL_Exc_FiltByExprDefault_TMM.csv"
# optional path to file containing differential expression results
edgeR_de_filename = "../edgeR_diff_expression/All_Exc/All_Exc_filtByExpr_edgeR_DE_QLFTest.csv"
path_to_rosmap_clin = "../ROSMAP_metadata/cleaned_rosmap_meta_cogdxConds.csv"
metabolon_filename = "../metabolic_data/ROSMAP_Metabolon_HD4_Brain514_assay_data.csv"
metabolon_datakey = "../metabolic_data/ROSMAP_Metabolon_HD4_Data_Dictionary.csv"
#BHQ corrected p cutoff to be considered cycling in analysis:
isCyclingBHQCutoff = 0.1
percentile = 0.
useBatch = T
setwd(path_to_cyclops_ordering)
if (!(dir.exists("downstream_output/plots"))){
dir.create("downstream_output/plots")
}
#for cycling_in_CTL.csv
plot_clock_face(paste0(path_to_cyclops_ordering, "/downstream_output/plots/CTL_clock_face_plot_AR1.png"), "downstream_output/cosinor_results_CTL.csv", mouse_data = mouse_data, BHQ_cutoff = isCyclingBHQCutoff, amp_ratio_cutoff = 0.1, force_align = 6.013, force_flipped = T)
#Force_align is to make the CTL_clock_face plot have ARNTL at top
setwd(path_to_cyclops_ordering)
#for cycling_in_AD.csv
plot_clock_face(paste0(path_to_cyclops_ordering, "/downstream_output/plots/AD_clock_face_plot_AR1.png"),"downstream_output/cosinor_results_AD.csv",mouse_data = mouse_data, BHQ_cutoff = isCyclingBHQCutoff, amp_ratio_cutoff = 0.1, force_align = 6.013, force_flipped = T)
#plot cyclops histogram
plot_subject_histogram(path_to_cyclops_ordering, "cond_0")
plot_subject_histogram(path_to_cyclops_ordering, "cond_1")
#Gene Tracings
genelist = c("ARNTL", "NPAS2", "CLOCK", "CRY1", "CRY2", "NR1D1", "NR1D2", "PER1", "PER2", "PER3", "DBP", "TEF")
plot_genes(path_to_tmm_file, path_to_cyclops_ordering,genelist, useBatch = useBatch, percentile = percentile, split_cond_plots = T)
setwd(path_to_cyclops_ordering)
if (!(dir.exists("downstream_output/plots"))){
dir.create("downstream_output/plots")
}
#for cycling_in_CTL.csv
plot_clock_face(paste0(path_to_cyclops_ordering, "/downstream_output/plots/CTL_clock_face_plot_AR1.png"), "downstream_output/cosinor_results_CTL.csv", mouse_data = mouse_data, BHQ_cutoff = isCyclingBHQCutoff, amp_ratio_cutoff = 0.1, force_align = 5.385, force_flipped = T)
#Force_align is to make the CTL_clock_face plot have ARNTL at top
setwd(path_to_cyclops_ordering)
#for cycling_in_AD.csv
plot_clock_face(paste0(path_to_cyclops_ordering, "/downstream_output/plots/AD_clock_face_plot_AR1.png"),"downstream_output/cosinor_results_AD.csv",mouse_data = mouse_data, BHQ_cutoff = isCyclingBHQCutoff, amp_ratio_cutoff = 0.1, force_align = 5.385, force_flipped = T)
#plot cyclops histogram
plot_subject_histogram(path_to_cyclops_ordering, "cond_0")
plot_subject_histogram(path_to_cyclops_ordering, "cond_1")
#Gene Tracings
genelist = c("ARNTL", "NPAS2", "CLOCK", "CRY1", "CRY2", "NR1D1", "NR1D2", "PER1", "PER2", "PER3", "DBP", "TEF")
plot_genes(path_to_tmm_file, path_to_cyclops_ordering,genelist, useBatch = useBatch, percentile = percentile, split_cond_plots = T)
plot_me = c("RPL18","RPS7","RPL22","RPS18","RPL8","RPL10A","RPS13","RPL14","RPS15A","RPS12","RPL36AL","RPL34","RPL30","RPL9","RPL21","RPS28","RPSA","RPL26","RPL27A","FAU","RPS3A","RPL7A","RPL17","RPS27A","RPS16","RPL15","RPLP1","RPL7","RPL10","RPL23A","RPL18A","RPL3","RPL12","RPL39","RPL37A","RPL37","RPS10","RPL13","RPL35A","RPS23","RPL13A","RPL38","RPS29","RPL24","RPL41","RPL35","RPS26","RPS2","RPS9","RPL32","RPL6","RPS21","RPS24","RPS25","RPL36","RPL19","RPS27","RPL29","RPS15","RPS3","RPS5","RPS8","RPL27","RSL24D1","RPS6","RPL11")
plot_genes(path_to_tmm_file, path_to_cyclops_ordering,plot_me, useBatch = useBatch, percentile = percentile, split_cond_plots = T)
library(reticulate) #use to find conda env for python
library(tidyverse)
source("./downstream_helpers/differential_rhyth_generalized.R")
source("./downstream_helpers/create_rnk_files.R")
source("./downstream_helpers/fgsea.R")
source("./downstream_helpers/Files_for_Pscan.R")
source("./downstream_helpers/Make_KEGG_map_files.R")
source("./downstream_helpers/Check_TF_for_cycling_or_DR.R")
source("./downstream_helpers/plot_clock_face_plots.R")
source("./downstream_helpers/plot_gene_traces_generalized.R")
source("./downstream_helpers/order_metabolon.R")
source("./downstream_helpers/order_proteomics.R")
conda_list()
conda_list()[[2]][2] %>%
use_condaenv(required = TRUE)
print(paste("Using cond env:",conda_list()[[1]][2] ))
#path to cyclops ordering
path_to_cyclops_ordering = "../Cyclops_ordering/"
#path to normalized counts
path_to_tmm_file = "../normed_counts/ALL_Ast_FiltByExprDefault_TMM.csv"
# optional path to file containing differential expression results
edgeR_de_filename = "../edgeR_diff_expression/All_Exc/All_Exc_filtByExpr_edgeR_DE_QLFTest.csv"
path_to_rosmap_clin = "../ROSMAP_metadata/cleaned_rosmap_meta_cogdxConds.csv"
metabolon_filename = "../metabolic_data/ROSMAP_Metabolon_HD4_Brain514_assay_data.csv"
metabolon_datakey = "../metabolic_data/ROSMAP_Metabolon_HD4_Data_Dictionary.csv"
#BHQ corrected p cutoff to be considered cycling in analysis:
isCyclingBHQCutoff = 0.1
percentile = 0.
useBatch = T
setwd(path_to_cyclops_ordering)
if (!(dir.exists("downstream_output/plots"))){
dir.create("downstream_output/plots")
}
#for cycling_in_CTL.csv
plot_clock_face(paste0(path_to_cyclops_ordering, "/downstream_output/plots/CTL_clock_face_plot_AR1.png"), "downstream_output/cosinor_results_CTL.csv", mouse_data = mouse_data, BHQ_cutoff = isCyclingBHQCutoff, amp_ratio_cutoff = 0.1, force_align = 5.385, force_flipped = T)
#Force_align is to make the CTL_clock_face plot have ARNTL at top
setwd(path_to_cyclops_ordering)
#for cycling_in_AD.csv
plot_clock_face(paste0(path_to_cyclops_ordering, "/downstream_output/plots/AD_clock_face_plot_AR1.png"),"downstream_output/cosinor_results_AD.csv",mouse_data = mouse_data, BHQ_cutoff = isCyclingBHQCutoff, amp_ratio_cutoff = 0.1, force_align = 5.385, force_flipped = T)
#plot cyclops histogram
plot_subject_histogram(path_to_cyclops_ordering, "cond_0")
plot_subject_histogram(path_to_cyclops_ordering, "cond_1")
#Gene Tracings
genelist = c("ARNTL", "NPAS2", "CLOCK", "CRY1", "CRY2", "NR1D1", "NR1D2", "PER1", "PER2", "PER3", "DBP", "TEF")
plot_genes(path_to_tmm_file, path_to_cyclops_ordering,genelist, useBatch = useBatch, percentile = percentile, split_cond_plots = T)
plot_me = c("RPL18","RPS7","RPL22","RPS18","RPL8","RPL10A","RPS13","RPL14","RPS15A","RPS12","RPL36AL","RPL34","RPL30","RPL9","RPL21","RPS28","RPSA","RPL26","RPL27A","FAU","RPS3A","RPL7A","RPL17","RPS27A","RPS16","RPL15","RPLP1","RPL7","RPL10","RPL23A","RPL18A","RPL3","RPL12","RPL39","RPL37A","RPL37","RPS10","RPL13","RPL35A","RPS23","RPL13A","RPL38","RPS29","RPL24","RPL41","RPL35","RPS26","RPS2","RPS9","RPL32","RPL6","RPS21","RPS24","RPS25","RPL36","RPL19","RPS27","RPL29","RPS15","RPS3","RPS5","RPS8","RPL27","RSL24D1","RPS6","RPL11")
plot_genes(path_to_tmm_file, path_to_cyclops_ordering,plot_me, useBatch = useBatch, percentile = percentile, split_cond_plots = T)
plot_clock_face(paste0(path_to_cyclops_ordering, "/downstream_output/plots/CTL_clock_face_plot_AR1.png"), "downstream_output/cosinor_results_CTL.csv", mouse_data = mouse_data, BHQ_cutoff = isCyclingBHQCutoff, amp_ratio_cutoff = 0., force_align = 5.385, force_flipped = T)
plot_clock_face(paste0(path_to_cyclops_ordering, "/downstream_output/plots/CTL_clock_face_plot_AR1.png"), "downstream_output/cosinor_results_CTL.csv", mouse_data = mouse_data, BHQ_cutoff = isCyclingBHQCutoff, amp_ratio_cutoff = 0., force_align = 5.385, force_flipped = T)
plot_clock_face(paste0(path_to_cyclops_ordering, "/downstream_output/plots/CTL_clock_face_plot.png"), "downstream_output/cosinor_results_CTL.csv", mouse_data = mouse_data, BHQ_cutoff = isCyclingBHQCutoff, amp_ratio_cutoff = 0., force_align = 5.385, force_flipped = T)
setwd("../Cyclops_ordering/downstream_output/")
plot_clock_face(paste0(path_to_cyclops_ordering, "/downstream_output/plots/CTL_clock_face_plot.png"), "downstream_output/cosinor_results_CTL.csv", mouse_data = mouse_data, BHQ_cutoff = isCyclingBHQCutoff, amp_ratio_cutoff = 0., force_align = 5.385, force_flipped = T)
setwd(path_to_cyclops_ordering)
if (!(dir.exists("downstream_output/plots"))){
dir.create("downstream_output/plots")
}
#for cycling_in_CTL.csv
plot_clock_face(paste0(path_to_cyclops_ordering, "/downstream_output/plots/CTL_clock_face_plot.png"), "downstream_output/cosinor_results_CTL.csv", mouse_data = mouse_data, BHQ_cutoff = isCyclingBHQCutoff, amp_ratio_cutoff = 0., force_align = 5.385, force_flipped = T)
#Force_align is to make the CTL_clock_face plot have ARNTL at top
setwd(path_to_cyclops_ordering)
#for cycling_in_AD.csv
plot_clock_face(paste0(path_to_cyclops_ordering, "/downstream_output/plots/AD_clock_face_plot.png"),"downstream_output/cosinor_results_AD.csv",mouse_data = mouse_data, BHQ_cutoff = isCyclingBHQCutoff, amp_ratio_cutoff = 0, force_align = 5.385, force_flipped = T)
#plot cyclops histogram
plot_subject_histogram(path_to_cyclops_ordering, "cond_0")
plot_subject_histogram(path_to_cyclops_ordering, "cond_1")
#Gene Tracings
genelist = c("ARNTL", "NPAS2", "CLOCK", "CRY1", "CRY2", "NR1D1", "NR1D2", "PER1", "PER2", "PER3", "DBP", "TEF")
plot_genes(path_to_tmm_file, path_to_cyclops_ordering,genelist, useBatch = useBatch, percentile = percentile, split_cond_plots = T)
library(reticulate) #use to find conda env for python
library(tidyverse)
source("./downstream_helpers/differential_rhyth_generalized.R")
source("./downstream_helpers/create_rnk_files.R")
source("./downstream_helpers/fgsea.R")
source("./downstream_helpers/Files_for_Pscan.R")
source("./downstream_helpers/Make_KEGG_map_files.R")
source("./downstream_helpers/Check_TF_for_cycling_or_DR.R")
source("./downstream_helpers/plot_clock_face_plots.R")
source("./downstream_helpers/plot_gene_traces_generalized.R")
source("./downstream_helpers/order_metabolon.R")
source("./downstream_helpers/order_proteomics.R")
#path to cyclops ordering
path_to_cyclops_ordering = "../Cyclops_ordering/"
#path to normalized counts
path_to_tmm_file = "../normed_counts/ALL_Exc_FiltByExprDefault_TMM.csv"
# optional path to file containing differential expression results
edgeR_de_filename = "../edgeR_diff_expression/All_Exc/All_Exc_filtByExpr_edgeR_DE_QLFTest.csv"
path_to_rosmap_clin = "../ROSMAP_metadata/cleaned_rosmap_meta_cogdxConds.csv"
metabolon_filename = "../metabolic_data/ROSMAP_Metabolon_HD4_Brain514_assay_data.csv"
metabolon_datakey = "../metabolic_data/ROSMAP_Metabolon_HD4_Data_Dictionary.csv"
#BHQ corrected p cutoff to be considered cycling in analysis:
isCyclingBHQCutoff = 0.1
percentile = 0.
useBatch = T
setwd(path_to_cyclops_ordering)
if (!(dir.exists("downstream_output/plots"))){
dir.create("downstream_output/plots")
}
#for cycling_in_CTL.csv
plot_clock_face(paste0(path_to_cyclops_ordering, "/downstream_output/plots/CTL_clock_face_plot.png"), "downstream_output/cosinor_results_CTL.csv", mouse_data = mouse_data, BHQ_cutoff = isCyclingBHQCutoff, amp_ratio_cutoff = 0., force_align = 5.385, force_flipped = T)
#Force_align is to make the CTL_clock_face plot have ARNTL at top
setwd(path_to_cyclops_ordering)
#for cycling_in_AD.csv
plot_clock_face(paste0(path_to_cyclops_ordering, "/downstream_output/plots/AD_clock_face_plot.png"),"downstream_output/cosinor_results_AD.csv",mouse_data = mouse_data, BHQ_cutoff = isCyclingBHQCutoff, amp_ratio_cutoff = 0, force_align = 5.385, force_flipped = T)
library(reticulate) #use to find conda env for python
library(tidyverse)
source("./downstream_helpers/differential_rhyth_generalized.R")
source("./downstream_helpers/create_rnk_files.R")
source("./downstream_helpers/fgsea.R")
source("./downstream_helpers/Files_for_Pscan.R")
source("./downstream_helpers/Make_KEGG_map_files.R")
source("./downstream_helpers/Check_TF_for_cycling_or_DR.R")
source("./downstream_helpers/plot_clock_face_plots.R")
source("./downstream_helpers/plot_gene_traces_generalized.R")
source("./downstream_helpers/order_metabolon.R")
source("./downstream_helpers/order_proteomics.R")
#path to cyclops ordering
path_to_cyclops_ordering = "../Cyclops_ordering/"
#path to normalized counts
path_to_tmm_file = "../normed_counts/ALL_Inh_FiltByExprDefault_TMM.csv"
# optional path to file containing differential expression results
edgeR_de_filename = "../edgeR_diff_expression/All_Exc/All_Exc_filtByExpr_edgeR_DE_QLFTest.csv"
path_to_rosmap_clin = "../ROSMAP_metadata/cleaned_rosmap_meta_cogdxConds.csv"
metabolon_filename = "../metabolic_data/ROSMAP_Metabolon_HD4_Brain514_assay_data.csv"
metabolon_datakey = "../metabolic_data/ROSMAP_Metabolon_HD4_Data_Dictionary.csv"
#BHQ corrected p cutoff to be considered cycling in analysis:
isCyclingBHQCutoff = 0.1
percentile = 0.
useBatch = T
setwd(path_to_cyclops_ordering)
if (!(dir.exists("downstream_output/plots"))){
dir.create("downstream_output/plots")
}
#for cycling_in_CTL.csv
plot_clock_face(paste0(path_to_cyclops_ordering, "/downstream_output/plots/CTL_clock_face_plot.png"), "downstream_output/cosinor_results_CTL.csv", mouse_data = mouse_data, BHQ_cutoff = isCyclingBHQCutoff, amp_ratio_cutoff = 0., force_align = 5.385, force_flipped = T)
#Force_align is to make the CTL_clock_face plot have ARNTL at top
setwd(path_to_cyclops_ordering)
#for cycling_in_AD.csv
plot_clock_face(paste0(path_to_cyclops_ordering, "/downstream_output/plots/AD_clock_face_plot.png"),"downstream_output/cosinor_results_AD.csv",mouse_data = mouse_data, BHQ_cutoff = isCyclingBHQCutoff, amp_ratio_cutoff = 0, force_align = 5.385, force_flipped = T)
#plot cyclops histogram
plot_subject_histogram(path_to_cyclops_ordering, "cond_0")
plot_subject_histogram(path_to_cyclops_ordering, "cond_1")
#Gene Tracings
genelist = c("ARNTL", "NPAS2", "CLOCK", "CRY1", "CRY2", "NR1D1", "NR1D2", "PER1", "PER2", "PER3", "DBP", "TEF")
plot_genes(path_to_tmm_file, path_to_cyclops_ordering,genelist, useBatch = useBatch, percentile = percentile, split_cond_plots = T)
setwd(path_to_cyclops_ordering)
if (!(dir.exists("downstream_output/plots"))){
dir.create("downstream_output/plots")
}
#for cycling_in_CTL.csv
plot_clock_face(paste0(path_to_cyclops_ordering, "/downstream_output/plots/CTL_clock_face_plot_AR1.png"), "downstream_output/cosinor_results_CTL.csv", mouse_data = mouse_data, BHQ_cutoff = isCyclingBHQCutoff, amp_ratio_cutoff = 0.1, force_align = 5.385, force_flipped = T)
#Force_align is to make the CTL_clock_face plot have ARNTL at top
setwd(path_to_cyclops_ordering)
#for cycling_in_AD.csv
plot_clock_face(paste0(path_to_cyclops_ordering, "/downstream_output/plots/AD_clock_face_plot_AR1.png"),"downstream_output/cosinor_results_AD.csv",mouse_data = mouse_data, BHQ_cutoff = isCyclingBHQCutoff, amp_ratio_cutoff = 0.1, force_align = 5.385, force_flipped = T)
#plot cyclops histogram
plot_subject_histogram(path_to_cyclops_ordering, "cond_0")
plot_subject_histogram(path_to_cyclops_ordering, "cond_1")
#Gene Tracings
genelist = c("ARNTL", "NPAS2", "CLOCK", "CRY1", "CRY2", "NR1D1", "NR1D2", "PER1", "PER2", "PER3", "DBP", "TEF")
plot_genes(path_to_tmm_file, path_to_cyclops_ordering,genelist, useBatch = useBatch, percentile = percentile, split_cond_plots = T)
plot_me = c("RPL18","RPS7","RPL22","RPS18","RPL8","RPL10A","RPS13","RPL14","RPS15A","RPS12","RPL36AL","RPL34","RPL30","RPL9","RPL21","RPS28","RPSA","RPL26","RPL27A","FAU","RPS3A","RPL7A","RPL17","RPS27A","RPS16","RPL15","RPLP1","RPL7","RPL10","RPL23A","RPL18A","RPL3","RPL12","RPL39","RPL37A","RPL37","RPS10","RPL13","RPL35A","RPS23","RPL13A","RPL38","RPS29","RPL24","RPL41","RPL35","RPS26","RPS2","RPS9","RPL32","RPL6","RPS21","RPS24","RPS25","RPL36","RPL19","RPS27","RPL29","RPS15","RPS3","RPS5","RPS8","RPL27","RSL24D1","RPS6","RPL11")
plot_genes(path_to_tmm_file, path_to_cyclops_ordering,plot_me, useBatch = useBatch, percentile = percentile, split_cond_plots = T)
